<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.MyPageDAO">

    <!-- select  -->
    <select id="readMyPosts" resultType="postdto" parameterType="int">
        SELECT post_idx as postIdx, title, content, regdate, address, category, grade, member_idx as memberIdx FROM post WHERE member_idx=#{memberIdx}
    </select>
    <!-- 서로 이웃 -->
    <select id="allFriends" resultType="frienddto" parameterType="int">
        SELECT friend_member_idx as friendMemberIdx FROM friend WHERE member_idx = #{memberIdx} AND is_friend = 1;
    </select>
    <!-- 내가 추가한 이웃 -->
    <select id="mySideFriends" resultType="frienddto" parameterType="int">
        SELECT friend_member_idx as friendMemberIdx FROM friend WHERE member_idx = #{memberIdx} AND is_friend = 0;
    </select>
    <!-- 나를 추가한 이웃 -->
    <select id="otherSideFriends" resultType="frienddto" parameterType="int">
        SELECT member_idx as memberIdx FROM friend WHERE friend_member_idx = #{memberIdx} AND is_friend = 0;
    </select>
    <!-- 전체국가 -->
    <select id="allFlags" resultType="flagdto">
        SELECT flag_idx as flagIdx, country, src FROM flag;
    </select>
    <!-- 전체사진 -->
    <select id="allImages" resultType="postimagedto">
        SELECT image_idx as imageIdx, src, post_idx as postIdx FROM post_image;
    </select>

    <!-- 친구 정보 조회 -->
    <select id="friendInfo" resultType="memberdto" parameterType="java.util.List">
        SELECT member_idx AS memberIdx, email, pw, member_name AS memberName, flag_idx AS flagIdx
        FROM members WHERE member_idx IN
        <foreach collection="list" item="idx" open="(" separator="," close=")">
            #{idx}
        </foreach>
    </select>

    <!-- 서로 이웃 삭제 -->
    <delete id="pairDelete" parameterType="int">
    DELETE FROM friend WHERE member_idx = #{member_Idx} AND friend_member_idx = #{memberIdx} AND is_friend = 1;
    </delete>

    <!-- 팔로잉 삭제 -->
    <delete id="followingDelete" parameterType="int">
    DELETE FROM friend WHERE member_idx = #{member_Idx} AND friend_member_idx = #{memberIdx} AND is_friend = 0;
    </delete>

    <!-- 팔로워 수락 -->
    <!-- is_friend를 1로 업데이트 -->
    <update id="followerAccept" parameterType="int">
    UPDATE friend
    SET is_friend = 1
    WHERE member_idx = #{memberIdx} AND friend_member_idx = #{member_Idx} AND is_friend = 0;
    </update>

    <insert id="createNewFriend" parameterType="int">
    INSERT into friend(friend_member_idx, is_friend, member_idx) 
    values(#{memberIdx},1,#{member_Idx});
    </insert>

    <!-- 팔로워 삭제 -->
    <delete id="followerDelete" parameterType="int">
    DELETE FROM friend WHERE member_idx = #{memberIdx} AND friend_member_idx = #{member_Idx} AND is_friend = 0;
    </delete>
</mapper>
